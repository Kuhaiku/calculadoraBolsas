<!DOCTYPE html>
<html lang="pt-BR" class="light">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Calculadora 3.0 (Design Otimizado)</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        
                        "background-light": "#F9F9F9",
                        "background-dark": "#101922",
                        
                        "card-light": "#FFFFFF",
                        "card-dark": "#192734",
                        
                        "surface-light": "#ffffff",
                        "surface-dark": "#1a2530",

                        "text-light": "#111418",
                        "text-dark": "#F6F7F8",
                        "text-light-primary": "#111418",
                        "text-dark-primary": "#f0f2f4",
                        
                        "text-secondary-light": "#617589",
                        "text-secondary-dark": "#9DAAB6",
                        "text-light-secondary": "#617589",
                        "text-dark-secondary": "#a0b3c6",

                        "border-light": "#dbe0e6",
                        "border-dark": "#34404C",
                        "border-dark-nav": "#344455",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-outlined.filled,
        .material-symbols-outlined.fill {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        body {
            min-height: max(884px, 100dvh);
        }
        /* Classe helper para esconder abas */
        .tab-panel.hidden,
        .input-conditional.hidden {
            display: none;
        }
        
        /* Estilos para Simulador de Corte Comparativo */
        .simulador-corte {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-top: 0.75rem;
        }
        /* Em telas maiores, mostra lado a lado */
        @media (min-width: 640px) {
            .simulador-corte {
                grid-template-columns: 1fr 1fr;
            }
        }
        .simulador-opcao {
            border: 2px solid;
            border-radius: 0.75rem; /* rounded-lg */
            padding: 0.75rem; /* p-3 */
            background-color: #f8fafc; /* bg-slate-50 */
        }
        .dark .simulador-opcao {
            background-color: #1e293b; /* dark:bg-slate-800 */
        }
        
        /* Opção Otimizada */
        .simulador-opcao.melhor {
            border-color: #16a34a; /* border-green-600 */
            box-shadow: 0 4px 10px rgba(22, 163, 74, 0.1);
        }
        /* Opção Alternativa */
        .simulador-opcao.pior {
            border-color: #dbe0e6; /* border-border-light */
            opacity: 0.8;
        }
        .dark .simulador-opcao.pior {
            border-color: #34404C; /* dark:border-border-dark */
        }

        .simulador-svg {
            width: 100%;
            height: 60px;
            border-radius: 0.25rem; /* rounded */
            margin-top: 0.5rem; /* mt-2 */
        }
        .svg-tecido {
            fill: #e2e8f0; /* fill-slate-200 */
        }
        .dark .svg-tecido {
            fill: #334155; /* dark:fill-slate-700 */
        }
        .svg-peca {
            fill: #60a5fa; /* fill-blue-400 */
            stroke: #2563eb; /* stroke-blue-600 */
            stroke-width: 1px;
        }
        .simulador-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            margin-top: 0.5rem; /* mt-2 */
            text-align: center;
        }

    </style>
</head>

<body class="light">
    <div class="relative flex min-h-screen w-full flex-col bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
        
        <header class="sticky top-0 z-10 flex h-16 items-center border-b border-border-light/80 bg-background-light/80 dark:border-border-dark/80 dark:bg-background-dark/80 px-4 backdrop-blur-sm">
            <h1 id="header-title" class="flex-1 text-center text-lg font-bold leading-tight tracking-[-0.015em] text-text-light dark:text-text-dark">
                Custos de Insumos
            </h1>
        </header>

        <main class="flex-1 pb-28">
            
            <div id="tab-insumos" class="tab-panel px-4 py-6">
                <div class="flex flex-col gap-6">
                    
                    <div class="rounded-xl bg-card-light dark:bg-card-dark p-5 shadow-[0_4px_12px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.1)]">
                        <h2 class="text-text-light dark:text-text-dark text-[22px] font-bold leading-tight tracking-[-0.015em] mb-4">Materiais Principais</h2>
                        
                        <h3 class="text-text-secondary-light dark:text-text-secondary-dark text-sm font-semibold uppercase tracking-wider mb-2 mt-4">Alça</h3>
                        <div class="flex flex-col gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Preço por Metro (R$)</p>
                                <input id="precoAlca" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="2" oninput="calcularTudo()">
                            </label>
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Cm por Bolsa (cm)</p>
                                <input id="cmAlca" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="120" oninput="calcularTudo()">
                            </label>
                        </div>
                        
                        <h3 class="text-text-secondary-light dark:text-text-secondary-dark text-sm font-semibold uppercase tracking-wider mb-2 mt-6">TNT</h3>
                        <div class="flex flex-col gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Preço por Metro (R$)</p>
                                <input id="precoTNT" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="5" oninput="calcularTudo()">
                            </label>
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Largura do Tecido (cm)</p>
                                <input id="larguraTNT" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="140" oninput="calcularTudo()">
                            </label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Altura da Peça (cm)</p>
                                    <input id="alturaPecaTNT" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="90" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Largura da Peça (cm)</p>
                                    <input id="larguraPecaTNT" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="45" oninput="calcularTudo()">
                                </label>
                            </div>
                        </div>
                        
                        <h3 class="text-text-secondary-light dark:text-text-secondary-dark text-sm font-semibold uppercase tracking-wider mb-2 mt-6">Algodão</h3>
                        <div class="flex flex-col gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Preço por Metro (R$)</p>
                                <input id="precoAlgodao" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="23.90" oninput="calcularTudo()">
                            </label>
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Largura do Tecido (cm)</p>
                                <input id="larguraAlgodao" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="180" oninput="calcularTudo()">
                            </label>
                            <div class="grid grid-cols-2 gap-4">
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Altura da Peça (cm)</p>
                                    <input id="alturaPecaAlgodao" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="90" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Largura da Peça (cm)</p>
                                    <input id="larguraPecaAlgodao" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="45" oninput="calcularTudo()">
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="rounded-xl bg-card-light dark:bg-card-dark p-5 shadow-[0_4px_12px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.1)]">
                        <h2 class="text-text-light dark:text-text-dark text-[22px] font-bold leading-tight tracking-[-0.015em] mb-4">Custos Variáveis</h2>
                        
                        <h3 class="text-text-secondary-light dark:text-text-secondary-dark text-sm font-semibold uppercase tracking-wider mb-2 mt-4">Extras (por bolsa)</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Etiqueta (R$)</p>
                                <input id="precoEtiqueta" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                            </label>
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Embalag. (R$)</p>
                                <input id="precoEmbalagem" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                            </label>
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Tinta (R$)</p>
                                <input id="precoTinta" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                            </label>
                        </div>
                        
                        <h3 class="text-text-secondary-light dark:text-text-secondary-dark text-sm font-semibold uppercase tracking-wider mb-2 mt-6">Mão de Obra (por bolsa)</h3>
                        <div class="flex flex-col gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Tipo de Cálculo</p>
                                <select id="tipoCalculoMaoDeObra" class="form-select h-14 w-full ... " onchange="atualizarVisibilidadeMaoDeObra()">
                                    <option value="fixo">Valor Fixo por Bolsa</option>
                                    <option value="hora">Valor por Hora</option>
                                </select>
                            </label>
                            
                            <label id="div-mao-obra-fixo" class="flex flex-col input-conditional">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Valor Fixo por Bolsa (R$)</p>
                                <input id="maoDeObraFixo" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                            </label>
                            
                            <div id="div-mao-obra-hora" class="grid grid-cols-2 gap-4 input-conditional hidden">
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Valor da Hora (R$)</p>
                                    <input id="maoDeObraValorHora" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Minutos por Bolsa</p>
                                    <input id="maoDeObraMinutosPorBolsa" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="0" type="number" value="0" oninput="calcularTudo()">
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="rounded-xl bg-card-light dark:bg-card-dark p-5 shadow-[0_4px_12px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.1)]">
                        <h2 class="text-text-light dark:text-text-dark text-[22px] font-bold leading-tight tracking-[-0.015em] mb-4">Custos Fixos (Rateio)</h2>
                        
                        <div class="flex flex-col gap-4">
                            <label class="flex flex-col">
                                <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Produção Mensal Estimada (un)</p>
                                <input id="producaoMensalEstimada" class="form-input h-14 w-full ... " inputmode="numeric" placeholder="100" type="number" value="100" oninput="calcularTudo()">
                            </label>
                            <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark -mt-2">Usado para ratear os custos fixos no preço de cada bolsa.</p>
                            
                            <div class="grid grid-cols-2 gap-4 mt-2">
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Aluguel (R$)</p>
                                    <input id="custoAluguel" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Luz (R$)</p>
                                    <input id="custoLuz" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Internet (R$)</p>
                                    <input id="custoInternet" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                                </label>
                                <label class="flex flex-col">
                                    <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Manutenção (R$)</p>
                                    <input id="custoManutencao" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                                </label>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div id="tab-custos" class="tab-panel hidden p-4 space-y-6">
                <div class="p-4 @container">
                    <div class="flex flex-col items-center justify-center rounded-xl bg-primary shadow-lg p-6 text-center">
                        <p class="text-white/80 text-base font-medium leading-normal">Custo Total por Bolsa</p>
                        <p id="outCustoTotal" class="text-white text-4xl font-bold leading-tight tracking-tighter mt-1">R$ 0,00</p>
                    </div>
                </div>
                <div class="px-4">
                    <h2 class="text-slate-500 dark:text-slate-400 text-sm font-semibold uppercase tracking-wider mb-3">Detalhamento de Custos</h2>
                    <div class="flex flex-col gap-2 rounded-xl bg-white dark:bg-slate-900/50 shadow-sm overflow-hidden p-2">
                        
                        <div class="flex items-center gap-4 px-4 py-3 min-h-14 justify-between">
                            <div class="flex items-center gap-4">
                                <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                    <span class="material-symbols-outlined text-2xl">category</span>
                                </div>
                                <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Custo Alça</p>
                            </div>
                            <div class="shrink-0">
                                <p id="outCustoAlca" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                            </div>
                        </div>
                        
                        <div class="flex flex-col px-4 py-3 min-h-14">
                            <div class="flex items-center gap-4 justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                        <span class="material-symbols-outlined text-2xl">texture</span>
                                    </div>
                                    <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Custo TNT</p>
                                </div>
                                <div class="shrink-0">
                                    <p id="outCustoTNT" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                                </div>
                            </div>
                            <div class="simulador-corte" id="simulador-tnt">
                                <div class="simulador-opcao" id="simulador-tnt-a">
                                    <p class="text-sm font-bold text-green-600">Opção Otimizada</p>
                                    <svg class="simulador-svg" id="svg-tnt-a"></svg>
                                    <p class="simulador-label" id="label-tnt-a">Calculando...</p>
                                </div>
                                <div class="simulador-opcao" id="simulador-tnt-b">
                                    <p class="text-sm font-semibold text-text-secondary-light dark:text-text-secondary-dark">Opção Alternativa</p>
                                    <svg class="simulador-svg" id="svg-tnt-b"></svg>
                                    <p class="simulador-label" id="label-tnt-b">Calculando...</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-col px-4 py-3 min-h-14">
                            <div class="flex items-center gap-4 justify-between">
                                <div class="flex items-center gap-4">
                                    <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                        <span class="material-symbols-outlined text-2xl">grid_on</span>
                                    </div>
                                    <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Custo Algodão</p>
                                </div>
                                <div class="shrink-0">
                                    <p id="outCustoAlgodao" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                                </div>
                            </div>
                            <div class="simulador-corte" id="simulador-algodao">
                                <div class="simulador-opcao" id="simulador-algodao-a">
                                    <p class="text-sm font-bold text-green-600">Opção Otimizada</p>
                                    <svg class="simulador-svg" id="svg-algodao-a"></svg>
                                    <p class="simulador-label" id="label-algodao-a">Calculando...</p>
                                </div>
                                <div class="simulador-opcao" id="simulador-algodao-b">
                                    <p class="text-sm font-semibold text-text-secondary-light dark:text-text-secondary-dark">Opção Alternativa</p>
                                    <svg class="simulador-svg" id="svg-algodao-b"></svg>
                                    <p class="simulador-label" id="label-algodao-b">Calculando...</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center gap-4 px-4 py-3 min-h-14 justify-between">
                            <div class="flex items-center gap-4">
                                <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                    <span class="material-symbols-outlined text-2xl">label</span>
                                </div>
                                <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Custos Variáveis Extras</p>
                            </div>
                            <div class="shrink-0">
                                <p id="outCustoVariavelExtra" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 px-4 py-3 min-h-14 justify-between">
                            <div class="flex items-center gap-4">
                                <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                    <span class="material-symbols-outlined text-2xl">engineering</span>
                                </div>
                                <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Custo Mão de Obra</p>
                            </div>
                            <div class="shrink-0">
                                <p id="outCustoMaoDeObra" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4 px-4 py-3 min-h-14 justify-between">
                            <div class="flex items-center gap-4">
                                <div class="text-slate-600 dark:text-slate-300 flex items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-800 shrink-0 size-10">
                                    <span class="material-symbols-outlined text-2xl">home_work</span>
                                </div>
                                <p class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal flex-1 truncate">Rateio Custo Fixo</p>
                            </div>
                            <div class="shrink-0">
                                <p id="outCustoFixoRateado" class="text-slate-800 dark:text-slate-100 text-base font-medium leading-normal">R$ 0,00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-producao" class="tab-panel hidden p-4">
                <div class="flex flex-col gap-2">
                    <label class="text-base font-medium text-text-light-primary dark:text-text-dark-primary" for="quantity">Quantas bolsas você quer produzir?</label>
                    <input id="metaProducao" class="form-input h-14 w-full rounded-xl border border-border-light bg-surface-light p-4 text-base text-text-light-primary placeholder:text-text-light-secondary focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-surface-dark dark:text-text-dark-primary dark:placeholder:text-text-dark-secondary dark:focus:border-primary"
                           placeholder="Ex: 50" type="number" value="30" oninput="calcularTudo()" />
                </div>
                <h2 class="pb-2 pt-8 text-lg font-bold tracking-tight text-text-light-primary dark:text-text-dark-primary">Lista de Compras (Materiais)</h2>
                <div class="flex flex-col divide-y divide-border-light overflow-hidden rounded-xl border border-border-light bg-surface-light dark:divide-border-dark dark:border-border-dark dark:bg-surface-dark">
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">straighten</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Metros a comprar (Alça)</p>
                        </div>
                        <p id="outMetaAlca" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">0 m</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">texture</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Metros a comprar (TNT)</p>
                        </div>
                        <p id="outMetaTNT" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">0 m</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">grid_on</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Metros a comprar (Algodão)</p>
                        </div>
                        <p id="outMetaAlgodao" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">0 m</p>
                    </div>
                </div>
                <div class="mt-8 flex flex-col gap-2 rounded-xl border border-primary/20 bg-primary/10 p-5 dark:border-primary/30 dark:bg-primary/20">
                    <p class="text-base font-medium text-primary dark:text-primary/90">Custo Total da Compra (Materiais)</p>
                    <p id="outCustoTotalCompra" class="text-4xl font-extrabold tracking-tighter text-text-light-primary dark:text-text-dark-primary">R$ 0,00</p>
                </div>
            </div>

            <div id="tab-vendas" class="tab-panel hidden p-4">
                <div class="flex flex-col gap-2">
                    <label class="text-base font-medium text-text-light-primary dark:text-text-dark-primary" for="valorVenda">Valor de Venda Unitário (R$)</label>
                    <input id="valorVenda" class="form-input h-14 w-full rounded-xl border border-border-light bg-surface-light p-4 text-base text-text-light-primary placeholder:text-text-light-secondary focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-surface-dark dark:text-text-dark-primary dark:placeholder:text-text-dark-secondary dark:focus:border-primary"
                           placeholder="Ex: 35,00" type="number" value="35" oninput="calcularTudo()" />
                </div>
                
                <h2 class="pb-2 pt-8 text-lg font-bold tracking-tight text-text-light-primary dark:text-text-dark-primary">Resumo do Lucro (Baseado na Produção)</h2>
                
                <div class="flex flex-col divide-y divide-border-light overflow-hidden rounded-xl border border-border-light bg-surface-light dark:divide-border-dark dark:border-border-dark dark:bg-surface-dark">
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">inventory</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Quantidade de Bolsas (Produção)</p>
                        </div>
                        <p id="outMetaVenda" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">0 un</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">shopping_cart</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Custo Total por Bolsa</g>
                        </div>
                        <p id="outCustoBolsaVenda" class="shrink-0 text-base font-medium text-red-600 dark:text-red-500">R$ 0,00</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">savings</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Lucro por Bolsa</p>
                        </div>
                        <p id="outLucroUnitario" class="shrink-0 text-base font-medium text-green-600 dark:text-green-500">R$ 0,00</p>
                    </div>
                </div>

                <div class="mt-8 flex flex-col gap-2 rounded-xl border border-primary/20 bg-primary/10 p-5 dark:border-primary/30 dark:bg-primary/20">
                    <p class="text-base font-medium text-primary dark:text-primary/90">Lucro Bruto Estimado Total (Produção)</p>
                    <p id="outLucroTotal" class="text-4xl font-extrabold tracking-tighter text-text-light-primary dark:text-text-dark-primary">R$ 0,00</p>
                </div>
            </div>
            
            <div id="tab-orcamento" class="tab-panel hidden p-4 space-y-6">
                
                <h2 class="pb-2 pt-2 text-lg font-bold tracking-tight text-text-light-primary dark:text-text-dark-primary">Resumo do Pedido (Cliente)</h2>
                <div class="flex flex-col divide-y divide-border-light overflow-hidden rounded-xl border border-border-light bg-surface-light dark:divide-border-dark dark:border-border-dark dark:bg-surface-dark">
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">inventory</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Quantidade de Bolsas</p>
                        </div>
                        <p id="outOrcamentoQuantidade" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">0 un</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">sell</span>
                            </div>
                            <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Valor Unitário (Venda)</p>
                        </div>
                        <p id="outOrcamentoPrecoUnitario" class="shrink-0 text-base font-medium text-text-light-primary dark:text-text-dark-primary">R$ 0,00</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <div class="flex items-center gap-4">
                            <div class="flex size-10 shrink-0 items-center justify-center rounded-lg bg-background-light dark:bg-background-dark">
                                <span class="material-symbols-outlined text-2xl text-text-light-secondary dark:text-text-dark-secondary">receipt_long</span>
                            </div>
                            <p class="flex-1 truncate text-base font-medium text-text-light-primary dark:text-text-dark-primary">Subtotal (Produtos)</p>
                        </div>
                        <p id="outOrcamentoSubtotal" class="shrink-0 text-base font-bold text-text-light-primary dark:text-text-dark-primary">R$ 0,00</p>
                    </div>
                </div>

                <div class="flex flex-col gap-4">
                    <label class="flex flex-col">
                        <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Valor do Frete (R$)</p>
                        <input id="orcamentoFrete" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                    </label>
                    <label class="flex flex-col">
                        <p class="text-base font-medium leading-normal pb-2 text-text-light dark:text-text-dark">Taxa de Urgência (R$)</p>
                        <input id="orcamentoTaxaUrgencia" class="form-input h-14 w-full ... " inputmode="decimal" placeholder="0,00" type="number" value="0" oninput="calcularTudo()">
                    </label>
                </div>
                
                <div class="mt-4 flex flex-col gap-2 rounded-xl border-2 border-primary p-5 dark:border-primary">
                    <p class="text-base font-medium text-primary dark:text-primary/90">Valor Total do Orçamento</p>
                    <p id="outOrcamentoTotal" class="text-4xl font-extrabold tracking-tighter text-text-light-primary dark:text-text-dark-primary">R$ 0,00</p>
                </div>

                <h2 class="pb-2 pt-4 text-lg font-bold tracking-tight text-text-light-primary dark:text-text-dark-primary">Resumo de Materiais (Referência)</h2>
                <div class="flex flex-col divide-y divide-border-light overflow-hidden rounded-xl border border-border-light bg-surface-light dark:divide-border-dark dark:border-border-dark dark:bg-surface-dark">
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Alça (por bolsa)</p>
                        <p id="outOrcamentoAlca" class="shrink-0 text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">0 cm</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Peça TNT (A x L)</p>
                        <p id="outOrcamentoTNT" class="shrink-0 text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">0cm x 0cm</p>
                    </div>
                    <div class="flex min-h-[3.5rem] items-center justify-between gap-4 p-4">
                        <p class="flex-1 truncate text-base text-text-light-primary dark:text-text-dark-primary">Peça Algodão (A x L)</p>
                        <p id="outOrcamentoAlgodao" class="shrink-0 text-base font-medium text-text-secondary-light dark:text-text-secondary-dark">0cm x 0cm</p>
                    </div>
                </div>

            </div>

        </main>

        <footer class="fixed bottom-0 z-10 w-full border-t border-border-light/80 bg-background-light/80 dark:border-border-dark/80 dark:bg-background-dark/80 pb-safe backdrop-blur-sm">
            <nav class="grid h-[72px] grid-cols-5 px-2"> 
                <a id="nav-insumos" class="nav-link flex flex-col items-center justify-center gap-1.5 text-primary" href="#" data-tab="insumos">
                    <span class="material-symbols-outlined text-2xl filled">widgets</span>
                    <span class="text-xs font-bold">Insumos</span>
                </a>
                <a id="nav-custos" class="nav-link flex flex-col items-center justify-center gap-1.5 text-text-secondary-light dark:text-text-secondary-dark" href="#" data-tab="custos">
                    <span class="material-symbols-outlined text-2xl">request_quote</span>
                    <span class="text-xs font-medium">Custos</span>
                </a>
                <a id="nav-producao" class="nav-link flex flex-col items-center justify-center gap-1.5 text-text-secondary-light dark:text-text-secondary-dark" href="#" data-tab="producao">
                    <span class="material-symbols-outlined text-2xl">inventory_2</span>
                    <span class="text-xs font-medium">Produção</span>
                </a>
                <a id="nav-vendas" class="nav-link flex flex-col items-center justify-center gap-1.5 text-text-secondary-light dark:text-text-secondary-dark" href="#" data-tab="vendas">
                    <span class="material-symbols-outlined text-2xl">trending_up</span>
                    <span class="text-xs font-medium">Vendas</span>
                </a>
                <a id="nav-orcamento" class="nav-link flex flex-col items-center justify-center gap-1.5 text-text-secondary-light dark:text-text-secondary-dark" href="#" data-tab="orcamento">
                    <span class="material-symbols-outlined text-2xl">receipt_long</span>
                    <span class="text-xs font-medium">Orçamento</span>
                </a>
            </nav>
        </footer>
    </div>

    <script>
        // Namespace para SVG
        const SVG_NS = 'http://www.w3.org/2000/svg';
        
        // --- FUNÇÕES HELPER ---

        function formatarMoeda(valor) {
            return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function lerFloat(id) {
            const el = document.getElementById(id);
            if (!el) return 0;
            return parseFloat(el.value) || 0;
        }

        function escreverValor(id, valor, tipo = 'moeda') {
            const el = document.getElementById(id);
            if (!el) return;
            
            if (tipo === 'moeda') {
                el.textContent = formatarMoeda(valor);
            } else if (tipo === 'metro') {
                el.textContent = valor.toFixed(2) + ' m';
            } else if (tipo === 'unidade') {
                el.textContent = valor.toString() + ' un';
            } else if (tipo === 'texto') {
                el.textContent = valor.toString();
            } else {
                el.textContent = valor.toString();
            }
        }
        
        const titulosAbas = {
            insumos: "Entrada de Insumos",
            custos: "Análise de Custos",
            producao: "Calculadora de Produção",
            vendas: "Planejamento de Venda",
            orcamento: "Orçamento para Cliente"
        };

        // --- LÓGICA DE NAVEGAÇÃO ---

        function atualizarVisibilidadeMaoDeObra() {
            const tipo = document.getElementById('tipoCalculoMaoDeObra').value;
            const divFixo = document.getElementById('div-mao-obra-fixo');
            const divHora = document.getElementById('div-mao-obra-hora');

            if (tipo === 'fixo') {
                divFixo.classList.remove('hidden');
                divHora.classList.add('hidden');
            } else { // 'hora'
                divFixo.classList.add('hidden');
                divHora.classList.remove('hidden');
            }
            calcularTudo();
        }

        function ativarAba(tabId) {
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            const newTab = document.getElementById(`tab-${tabId}`);
            if(newTab) newTab.classList.remove('hidden');

            if(titulosAbas[tabId]) {
                document.getElementById('header-title').textContent = titulosAbas[tabId];
            }

            document.querySelectorAll('.nav-link').forEach(link => {
                const linkIcon = link.querySelector('.material-symbols-outlined');
                const linkLabel = link.querySelector('span:last-child');

                if (link.dataset.tab === tabId) {
                    link.classList.add('text-primary');
                    link.classList.remove('text-text-secondary-light', 'dark:text-text-secondary-dark');
                    linkIcon.classList.add('filled');
                    linkLabel.classList.add('font-bold');
                    linkLabel.classList.remove('font-medium');
                } else {
                    link.classList.remove('text-primary');
                    link.classList.add('text-text-secondary-light', 'dark:text-text-secondary-dark');
                    linkIcon.classList.remove('filled');
                    linkLabel.classList.remove('font-bold');
                    linkLabel.classList.add('font-medium');
                }
            });
        }

        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const tabId = e.currentTarget.dataset.tab;
                ativarAba(tabId);
            });
        });

        // --- LÓGICA DE OTIMIZAÇÃO DE CORTE ---

        /**
         * Calcula o custo para uma orientação específica.
         */
        function calcularCustoOrientacao(precoMetro, larguraTecido, dimensaoNaLargura, dimensaoNoComprimento) {
            if (dimensaoNaLargura === 0 || larguraTecido < dimensaoNaLargura) {
                return { custoUnitario: Infinity, pecasPorLargura: 0, alturaFileira: 0 };
            }
            
            const pecasPorLargura = Math.floor(larguraTecido / dimensaoNaLargura);
            if (pecasPorLargura === 0) {
                return { custoUnitario: Infinity, pecasPorLargura: 0, alturaFileira: 0 };
            }

            const custoFileira = (dimensaoNoComprimento / 100) * precoMetro;
            const custoUnitario = custoFileira / pecasPorLargura;
            
            return {
                custoUnitario: custoUnitario,
                pecasPorLargura: pecasPorLargura,
                alturaFileira: dimensaoNoComprimento, // O quanto "puxa" do rolo
                dimensaoUsadaNaLargura: dimensaoNaLargura
            };
        }

        /**
         * Calcula o melhor aproveitamento, comparando as duas orientações.
         * @returns {Object} Contém as duas opções (padrao e rotacionada) e a melhor.
         */
        function calcularAproveitamentoOtimizado(precoMetro, larguraTecido, alturaPeca, larguraPeca) {
            if (!larguraTecido || !alturaPeca || !larguraPeca || !precoMetro) {
                const invalido = { custoUnitario: 0, pecasPorLargura: 1, alturaFileira: 0, dimensaoUsadaNaLargura: 0, orientacao: 'inválida' };
                return { padrao: invalido, rotacionada: invalido, melhor: invalido };
            }

            // Opção 1: Padrão (Largura Peça na Largura Tecido)
            const resPadrao = calcularCustoOrientacao(precoMetro, larguraTecido, larguraPeca, alturaPeca);
            resPadrao.orientacao = "Padrão"; // (Largura da Peça)

            // Opção 2: Rotacionada (Altura Peça na Largura Tecido)
            const resRotacionada = calcularCustoOrientacao(precoMetro, larguraTecido, alturaPeca, larguraPeca);
            resRotacionada.orientacao = "Rotacionada"; // (Altura da Peça)

            let resultado;
            if (resPadrao.custoUnitario <= resRotacionada.custoUnitario) {
                resultado = {
                    padrao: resPadrao,
                    rotacionada: resRotacionada,
                    melhor: resPadrao
                };
            } else {
                resultado = {
                    padrao: resPadrao,
                    rotacionada: resRotacionada,
                    melhor: resRotacionada
                };
            }
            return resultado;
        }
        
        /**
         * Desenha uma opção de corte no SVG
         */
        function desenharOpcaoDeCorte(svgId, labelId, opcao, larguraTecido) {
            const svg = document.getElementById(svgId);
            const label = document.getElementById(labelId);
            if (!svg || !label) return;

            // Limpar SVG
            while (svg.firstChild) {
                svg.removeChild(svg.firstChild);
            }

            // 1. Desenhar o Tecido (fundo)
            const tecidoRect = document.createElementNS(SVG_NS, 'rect');
            tecidoRect.setAttribute('x', '0');
            tecidoRect.setAttribute('y', '0');
            tecidoRect.setAttribute('width', '100%');
            tecidoRect.setAttribute('height', '100%');
            tecidoRect.setAttribute('class', 'svg-tecido');
            svg.appendChild(tecidoRect);

            if (!opcao || opcao.pecasPorLargura === 0 || !isFinite(opcao.custoUnitario)) {
                label.textContent = "Corte Inválido";
                return;
            }

            // 2. Desenhar as Peças
            const larguraPecaPercent = (opcao.dimensaoUsadaNaLargura / larguraTecido) * 100;
            
            for (let i = 0; i < opcao.pecasPorLargura; i++) {
                const pecaRect = document.createElementNS(SVG_NS, 'rect');
                pecaRect.setAttribute('x', `${i * larguraPecaPercent}%`);
                pecaRect.setAttribute('y', '5%'); // Margem
                pecaRect.setAttribute('width', `${larguraPecaPercent}%`);
                pecaRect.setAttribute('height', '90%'); // Margem
                pecaRect.setAttribute('class', 'svg-peca');
                svg.appendChild(pecaRect);
            }

            // 3. Atualizar Label
            label.textContent = `${opcao.orientacao}: Cabem ${opcao.pecasPorLargura} un. Custo: ${formatarMoeda(opcao.custoUnitario)}`;
        }


        /**
         * (CORRIGIDO) Atualiza a visualização comparativa
         */
        function atualizarVisualizacaoComparativa(containerPrefix, svgPrefix, labelPrefix, resultado, larguraTecido) {
            const containerA = document.getElementById(`${containerPrefix}-a`);
            const containerB = document.getElementById(`${containerPrefix}-b`);
            
            if (!containerA || !containerB) return;

            // Identificar qual é a melhor e qual é a pior
            const melhor = resultado.melhor;
            const pior = (melhor.orientacao === resultado.padrao.orientacao) ? resultado.rotacionada : resultado.padrao;

            // Configurar a Opção Otimizada (A)
            containerA.className = 'simulador-opcao melhor';
            desenharOpcaoDeCorte(`${svgPrefix}-a`, `${labelPrefix}-a`, melhor, larguraTecido); // <-- CORRIGIDO

            // Configurar a Opção Alternativa (B)
            containerB.className = 'simulador-opcao pior';
            desenharOpcaoDeCorte(`${svgPrefix}-b`, `${labelPrefix}-b`, pior, larguraTecido); // <-- CORRIGIDO
        }

        // --- LÓGICA PRINCIPAL DE CÁLCULO ---
        
        let resultadoOtimizadoTNT = {};
        let resultadoOtimizadoAlgodao = {};

        function calcularTudo() {
            // --- 1. LER TODOS OS INPUTS ---
            
            // Materiais
            const precoAlca = lerFloat('precoAlca');
            const cmAlca = lerFloat('cmAlca');
            const precoTNT = lerFloat('precoTNT');
            const larguraTNT = lerFloat('larguraTNT');
            const alturaPecaTNT = lerFloat('alturaPecaTNT');
            const larguraPecaTNT = lerFloat('larguraPecaTNT');
            const precoAlgodao = lerFloat('precoAlgodao');
            const larguraAlgodao = lerFloat('larguraAlgodao');
            const alturaPecaAlgodao = lerFloat('alturaPecaAlgodao');
            const larguraPecaAlgodao = lerFloat('larguraPecaAlgodao');
            
            // Custos Variáveis Extras
            const precoEtiqueta = lerFloat('precoEtiqueta');
            const precoEmbalagem = lerFloat('precoEmbalagem');
            const precoTinta = lerFloat('precoTinta');

            // Mão de Obra
            const tipoCalculoMaoDeObra = document.getElementById('tipoCalculoMaoDeObra').value;
            const maoDeObraFixo = lerFloat('maoDeObraFixo');
            const maoDeObraValorHora = lerFloat('maoDeObraValorHora');
            const maoDeObraMinutosPorBolsa = lerFloat('maoDeObraMinutosPorBolsa');

            // Custos Fixos
            const producaoMensalEstimada = lerFloat('producaoMensalEstimada') || 1;
            const custoAluguel = lerFloat('custoAluguel');
            const custoLuz = lerFloat('custoLuz');
            const custoInternet = lerFloat('custoInternet');
            const custoManutencao = lerFloat('custoManutencao');

            // Produção e Vendas
            const metaProducao = lerFloat('metaProducao');
            const valorVenda = lerFloat('valorVenda');
            
            // Orçamento
            const orcamentoFrete = lerFloat('orcamentoFrete');
            const orcamentoTaxaUrgencia = lerFloat('orcamentoTaxaUrgencia');


            // --- 2. CALCULAR CUSTOS UNITÁRIOS (Aba "Custos") ---

            const custoUnitarioAlca = (cmAlca / 100) * precoAlca;
            
            // Cálculo Otimizado
            resultadoOtimizadoTNT = calcularAproveitamentoOtimizado(precoTNT, larguraTNT, alturaPecaTNT, larguraPecaTNT);
            const custoUnitarioTNT = resultadoOtimizadoTNT.melhor.custoUnitario;
            
            resultadoOtimizadoAlgodao = calcularAproveitamentoOtimizado(precoAlgodao, larguraAlgodao, alturaPecaAlgodao, larguraPecaAlgodao);
            const custoUnitarioAlgodao = resultadoOtimizadoAlgodao.melhor.custoUnitario;

            // Custo Variável Extra
            const custoUnitarioVariavelExtra = precoEtiqueta + precoEmbalagem + precoTinta;
            
            // Custo Mão de Obra
            let custoUnitarioMaoDeObra = 0;
            if (tipoCalculoMaoDeObra === 'fixo') {
                custoUnitarioMaoDeObra = maoDeObraFixo;
            } else {
                custoUnitarioMaoDeObra = (maoDeObraValorHora / 60) * maoDeObraMinutosPorBolsa;
            }

            // Custo Fixo Rateado
            const totalCustosFixosMensais = custoAluguel + custoLuz + custoInternet + custoManutencao;
            const custoUnitarioFixoRateado = totalCustosFixosMensais / producaoMensalEstimada;

            // Custo Total
            const custoTotalPorBolsa = custoUnitarioAlca + 
                                       (isFinite(custoUnitarioTNT) ? custoUnitarioTNT : 0) + 
                                       (isFinite(custoUnitarioAlgodao) ? custoUnitarioAlgodao : 0) + 
                                       custoUnitarioVariavelExtra + 
                                       custoUnitarioMaoDeObra + 
                                       custoUnitarioFixoRateado;

            // --- 3. ATUALIZAR ABA "Custos" ---
            escreverValor('outCustoAlca', custoUnitarioAlca, 'moeda');
            escreverValor('outCustoTNT', isFinite(custoUnitarioTNT) ? custoUnitarioTNT : 0, 'moeda');
            escreverValor('outCustoAlgodao', isFinite(custoUnitarioAlgodao) ? custoUnitarioAlgodao : 0, 'moeda');
            escreverValor('outCustoVariavelExtra', custoUnitarioVariavelExtra, 'moeda');
            escreverValor('outCustoMaoDeObra', custoUnitarioMaoDeObra, 'moeda');
            escreverValor('outCustoFixoRateado', custoUnitarioFixoRateado, 'moeda');
            escreverValor('outCustoTotal', custoTotalPorBolsa, 'moeda');
            
            // (CORRIGIDO) Atualizar Visualizações Comparativas
            atualizarVisualizacaoComparativa('simulador-tnt', 'svg-tnt', 'label-tnt', resultadoOtimizadoTNT, larguraTNT);
            atualizarVisualizacaoComparativa('simulador-algodao', 'svg-algodao', 'label-algodao', resultadoOtimizadoAlgodao, larguraAlgodao);


            // --- 4. CALCULAR LISTA DE COMPRAS (Aba "Produção") ---
            
            const metrosAlcaComprar = metaProducao * (cmAlca / 100);
            
            const pecasPorFileiraTNT = resultadoOtimizadoTNT.melhor.pecasPorLargura || 1;
            const alturaFileiraTNT = resultadoOtimizadoTNT.melhor.alturaFileira;
            const fileirasTNTComprar = Math.ceil(metaProducao / pecasPorFileiraTNT);
            const metrosTNTComprar = fileirasTNTComprar * (alturaFileiraTNT / 100);
            
            const pecasPorFileiraAlgodao = resultadoOtimizadoAlgodao.melhor.pecasPorLargura || 1;
            const alturaFileiraAlgodao = resultadoOtimizadoAlgodao.melhor.alturaFileira;
            const fileirasAlgodaoComprar = Math.ceil(metaProducao / pecasPorFileiraAlgodao);
            const metrosAlgodaoComprar = fileirasAlgodaoComprar * (alturaFileiraAlgodao / 100);

            // Custo Total da Compra (Apenas Materiais)
            const custoMetaAlca = metrosAlcaComprar * precoAlca;
            const custoMetaTNT = metrosTNTComprar * precoTNT;
            const custoMetaAlgodao = metrosAlgodaoComprar * precoAlgodao;
            const custoTotalMeta = custoMetaAlca + custoMetaTNT + custoMetaAlgodao;

            // --- 5. ATUALIZAR ABA "Produção" ---
            escreverValor('outMetaAlca', metrosAlcaComprar, 'metro');
            escreverValor('outMetaTNT', metrosTNTComprar, 'metro');
            escreverValor('outMetaAlgodao', metrosAlgodaoComprar, 'metro');
            escreverValor('outCustoTotalCompra', custoTotalMeta, 'moeda');

            // --- 6. CALCULAR LUCRO (Aba "Vendas") ---
            const lucroBrutoUnitario = valorVenda - custoTotalPorBolsa;
            const lucroBrutoTotal = lucroBrutoUnitario * metaProducao;

            // --- 7. ATUALIZAR ABA "Vendas" ---
            escreverValor('outMetaVenda', metaProducao, 'unidade');
            escreverValor('outCustoBolsaVenda', custoTotalPorBolsa, 'moeda');
            escreverValor('outLucroUnitario', lucroBrutoUnitario, 'moeda');
            escreverValor('outLucroTotal', lucroBrutoTotal, 'moeda');

            // --- 8. CALCULAR E ATUALIZAR ABA "Orçamento" ---
            const subtotalOrcamento = metaProducao * valorVenda;
            const totalOrcamento = subtotalOrcamento + orcamentoFrete + orcamentoTaxaUrgencia;
            
            escreverValor('outOrcamentoQuantidade', metaProducao, 'unidade');
            escreverValor('outOrcamentoPrecoUnitario', valorVenda, 'moeda');
            // (LINHA CORRIGIDA - 947)
            escreverValor('outOrcamentoSubtotal', subtotalOrcamento, 'moeda');
            escreverValor('outOrcamentoTotal', totalOrcamento, 'moeda');

            // Resumo de Materiais no Orçamento
            escreverValor('outOrcamentoAlca', cmAlca + ' cm', 'texto');
            escreverValor('outOrcamentoTNT', `${alturaPecaTNT}cm x ${larguraPecaTNT}cm`, 'texto');
            escreverValor('outOrcamentoAlgodao', `${alturaPecaAlgodao}cm x ${larguraPecaAlgodao}cm`, 'texto');
        }

        // --- INICIALIZAÇÃO ---
        window.onload = () => {
            ativarAba('insumos');
            atualizarVisibilidadeMaoDeObra();
            calcularTudo();
        };

    </script>
</body>
</html>
